---
chunk_index: 126
ref: "a27b1b8d6087"
id: "a27b1b8d60876eeb8a23ac3b39e99f19bf36b3395f734c9b1e9312649534263c"
slug: "agent-handoff--search-handler-phase-5-modification-point"
path: "/home/zack/dev/llmx/docs/AGENT_HANDOFF.md"
kind: "markdown"
lines: [403, 427]
token_estimate: 188
content_sha256: "0f5b7a0928c10ab461bb10825dcb1c1b0eb110f62e1cf8c4334e908dda65b239"
compacted: false
heading_path: ["Agent Handoff Document","Key Files Reference","Search Handler (Phase 5 modification point)"]
symbol: null
address: null
asset_path: null
---

### Search Handler (Phase 5 modification point)
```rust
// src/mcp/tools.rs:254
pub fn llmx_search_handler(
    store: &mut IndexStore,
    input: SearchInput
) -> Result<SearchOutput> {
    // 1. Load index
    let index = store.load(&input.index_id)?;

    // 2. BM25 search (existing)
    let search_results = search(index, &input.query, filters, limit * 2);

    // 3. Phase 5: Add semantic search here
    //    if input.use_semantic == Some(true) {
    //        let embeddings = generate_embeddings(&input.query)?;
    //        let semantic_results = vector_search(index, embeddings)?;
    //        search_results = hybrid_rank(search_results, semantic_results);
    //    }

    // 4. Apply token budget (keep existing logic)
    // ...
}
```