---
chunk_index: 1244
ref: "809c554e1e43"
id: "809c554e1e43a8694bafc5115cee9e11e873028f33143f118f9d317f65de6c9a"
slug: "ingestor-wasm--wbg-load"
path: "/home/zack/dev/llmx/ingestor-wasm/pkg/ingestor_wasm.js"
kind: "java_script"
lines: [1195, 1228]
token_estimate: 331
content_sha256: "4f10200f896b6ccd783de061243d0e764b76f5473ab7eb46b9cf93e93d762778"
compacted: false
heading_path: []
symbol: "__wbg_load"
address: null
asset_path: null
---

async function __wbg_load(module, imports) {
    if (typeof Response === 'function' && module instanceof Response) {
        if (typeof WebAssembly.instantiateStreaming === 'function') {
            try {
                return await WebAssembly.instantiateStreaming(module, imports);
            } catch (e) {
                const validResponse = module.ok && expectedResponseType(module.type);

                if (validResponse && module.headers.get('Content-Type') !== 'application/wasm') {
                    console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n", e);

                } else { throw e; }
            }
        }

        const bytes = await module.arrayBuffer();
        return await WebAssembly.instantiate(bytes, imports);
    } else {
        const instance = await WebAssembly.instantiate(module, imports);

        if (instance instanceof WebAssembly.Instance) {
            return { instance, module };
        } else {
            return instance;
        }
    }

    function expectedResponseType(type) {
        switch (type) {
            case 'basic': case 'cors': case 'default': return true;
        }
        return false;
    }
}