---
chunk_index: 1094
ref: "134ba0997d90"
id: "134ba0997d901c593fddc456b6a2996b2f3f704be0779ab1cc6b7d71f23dc8fc"
slug: "chunking-tests-l118-154"
path: "/home/zack/dev/llmx/ingestor-core/tests/chunking_tests.rs"
kind: "text"
lines: [118, 154]
token_estimate: 311
content_sha256: "49529d59945ca4c42efeb39dea7b45557548d637b81f9e1e2466feb18cd9d4c4"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

#[test]
fn selective_update_keeps_unchanged_paths() {
    let options = IngestOptions::default();
    let prev = ingest_files(
        vec![
            ingestor_core::FileInput {
                path: "docs/a.md".to_string(),
                data: b"# A\n\nHello\n".to_vec(),
                mtime_ms: None,
                fingerprint_sha256: Some("fp-a".to_string()),
            },
            ingestor_core::FileInput {
                path: "docs/b.md".to_string(),
                data: b"# B\n\nOld\n".to_vec(),
                mtime_ms: None,
                fingerprint_sha256: Some("fp-b".to_string()),
            },
        ],
        options.clone(),
    );

    let updated = ingestor_core::update_index_selective(
        prev,
        vec![ingestor_core::FileInput {
            path: "docs/b.md".to_string(),
            data: b"# B\n\nNew\n".to_vec(),
            mtime_ms: None,
            fingerprint_sha256: Some("fp-b2".to_string()),
        }],
        vec!["docs/a.md".to_string()],
        options,
    );

    let paths: Vec<String> = updated.files.iter().map(|f| f.path.clone()).collect();
    assert_eq!(paths, vec!["docs/a.md".to_string(), "docs/b.md".to_string()]);
    assert_eq!(updated.warnings.len(), 0);
}