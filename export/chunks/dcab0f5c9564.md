---
chunk_index: 713
ref: "dcab0f5c9564"
id: "dcab0f5c956458d045250b5a3c08dbc91735cc4bf23b92a6c76c210f9929f2b4"
slug: "post-p6-enhancements--5-self-tuning-from-agent-behavior"
path: "/home/zack/dev/llmx/docs/POST_P6_ENHANCEMENTS.md"
kind: "markdown"
lines: [192, 233]
token_estimate: 313
content_sha256: "44fdc7b61702888c96592aec072cd0b27dc6eb1b7479d200761099cfbeaedc98"
compacted: false
heading_path: ["Post-Phase 6 Enhancements","5. Self-Tuning from Agent Behavior"]
symbol: null
address: null
asset_path: null
---

## 5. Self-Tuning from Agent Behavior

**Insight:** Track which search results agents actually use. Learn to boost useful patterns.

```rust
pub struct AgentFeedback {
    pub query_embedding: Vec<f32>,  // Privacy: don't store raw query
    pub clicked_chunks: Vec<String>,
    pub task_completed: bool,
    pub timestamp: SystemTime,
}

pub fn learned_boost(&self, query: &str, chunk_id: &str) -> f32 {
    // Find similar past queries
    let query_emb = generate_embedding(query);
    let similar = self.feedback.iter()
        .filter(|f| cosine_similarity(&f.query_embedding, &query_emb) > 0.7)
        .collect();

    if similar.is_empty() { return 0.0; }

    // Click rate for this chunk on similar queries
    let clicks = similar.iter()
        .filter(|f| f.clicked_chunks.contains(&chunk_id))
        .count() as f32;
    
    // Success rate when clicked
    let successes = similar.iter()
        .filter(|f| f.clicked_chunks.contains(&chunk_id) && f.task_completed)
        .count() as f32;

    (clicks / similar.len() as f32) * 0.5 + (successes / clicks.max(1.0)) * 0.5
}

// Apply in ranking
let final_score = bm25_score * 0.7 + learned_boost * 0.3;
```

**Bootstrapping:** Needs ~100 queries before meaningful patterns emerge.

---