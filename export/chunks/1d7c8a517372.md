---
chunk_index: 1388
ref: "1d7c8a517372"
id: "1d7c8a517372fdf29d72d36724bec79c1368405351e4ac5b52b2510483926c88"
slug: "ingestor-wasm--makemutclosure"
path: "/home/zack/dev/llmx/web/pkg/ingestor_wasm.js"
kind: "java_script"
lines: [1643, 1669]
token_estimate: 203
content_sha256: "d8892bb65a50491fdb70543e69d14c52cda950bbde5623c8181dd02d8069de99"
compacted: false
heading_path: []
symbol: "makeMutClosure"
address: null
asset_path: null
---

function makeMutClosure(arg0, arg1, dtor, f) {
    const state = { a: arg0, b: arg1, cnt: 1, dtor };
    const real = (...args) => {

        // First up with a closure we increment the internal reference
        // count. This ensures that the Rust closure environment won't
        // be deallocated while we're invoking it.
        state.cnt++;
        const a = state.a;
        state.a = 0;
        try {
            return f(a, state.b, ...args);
        } finally {
            state.a = a;
            real._wbg_cb_unref();
        }
    };
    real._wbg_cb_unref = () => {
        if (--state.cnt === 0) {
            state.dtor(state.a, state.b);
            state.a = 0;
            CLOSURE_DTORS.unregister(state);
        }
    };
    CLOSURE_DTORS.register(real, state, state);
    return real;
}