---
chunk_index: 300
ref: "eb4a40349937"
id: "eb4a40349937bb84de56b176fff694ad35e6261eca2ddb22edac0f39602bcd17"
slug: "p6-directions--5-backward-compatibility"
path: "/home/zack/dev/llmx/docs/P6_DIRECTIONS.md"
kind: "markdown"
lines: [316, 345]
token_estimate: 201
content_sha256: "4d4d60a05f04887218e9c969fcf5ec3760ea67938301ea4f6f48c8824648b052"
compacted: false
heading_path: ["Phase 6: Burn + WebGPU Embeddings & Advanced Hybrid Search","5. Backward Compatibility"]
symbol: null
address: null
asset_path: null
---

## 5. Backward Compatibility

**Critical: Support all embedding versions**
```rust
match index.embedding_model.as_deref() {
    Some("hash-based-v1") => {
        // Phase 5 hash embeddings - still work
        let query_emb = hash_embedding(&query);
        hybrid_search_hash(...)
    }
    Some("bge-small-en-v1.5") | Some("nomic-embed-text-v1.5") => {
        // Phase 6 Burn embeddings
        let query_emb = burn_embedding(&query).await?;
        hybrid_search_real(...)
    }
    None => {
        // No embeddings (pre-Phase 5 index)
        bm25_search(...)
    }
    Some(unknown) => {
        warn!("Unknown embedding model: {}, falling back to BM25", unknown);
        bm25_search(...)
    }
}
```

**Never mix embedding models** - cosine similarity meaningless across different spaces.

---