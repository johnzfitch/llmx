---
chunk_index: 1107
ref: "11d2511b296e"
id: "11d2511b296ee001d654d501f03230cfc8401bc2772cb97e3e034ae3b46dfd68"
slug: "export-tests-l121-182"
path: "/home/zack/dev/llmx/ingestor-core/tests/export_tests.rs"
kind: "text"
lines: [121, 182]
token_estimate: 578
content_sha256: "d483c5d5a4761d8c0c101674a07022bb34c648cf4e9425b0b366a72b294ec4a0"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

let columns = value
        .get("chunk_columns")
        .and_then(|v| v.as_array())
        .expect("chunk_columns");
    assert!(!columns.is_empty(), "expected chunk_columns");

    let paths = value.get("paths").and_then(|v| v.as_array()).expect("paths");
    let kinds = value.get("kinds").and_then(|v| v.as_array()).expect("kinds");

    let rows = value.get("chunks").and_then(|v| v.as_array()).expect("chunks");
    assert!(!rows.is_empty(), "expected chunk rows");

    for row in rows {
        let row = row.as_array().expect("chunk row array");
        assert_eq!(
            row.len(),
            columns.len(),
            "expected chunk row length to match chunk_columns length"
        );

        let r#ref = row.get(0).and_then(|v| v.as_str()).expect("ref");
        let path_i = row.get(3).and_then(|v| v.as_u64()).expect("path_i") as usize;
        let kind_i = row.get(4).and_then(|v| v.as_u64()).expect("kind_i") as usize;

        assert!(path_i < paths.len(), "path_i out of range");
        assert!(kind_i < kinds.len(), "kind_i out of range");

        let derived_chunk_file = format!("chunks/{}.md", r#ref);
        assert!(derived_chunk_file.starts_with("chunks/"));
        assert!(derived_chunk_file.ends_with(".md"));
    }
}
#[cfg(test)]
mod tests {
    use ingestor_core::{export_llm, ingest_files, FileInput, IngestOptions};

    #[test]
    #[ignore]
    fn show_output_format() {
        let md_input = FileInput {
            path: "docs/api-reference.md".to_string(),
            data: b"# API Reference\n\n## Authentication\n\nUse JWT tokens.\n\n## Rate Limiting\n\nLimited to 1000/hour.\n".to_vec(),
            mtime_ms: None,
            fingerprint_sha256: None,
        };

        let js_input = FileInput {
            path: "src/auth.js".to_string(),
            data: b"function loginUser(credentials) {\n  return authenticate(credentials);\n}\n\nfunction logout() {\n  clearSession();\n}\n".to_vec(),
            mtime_ms: None,
            fingerprint_sha256: None,
        };

        let index = ingest_files(vec![md_input, js_input], IngestOptions::default());
        let llm = export_llm(&index);
        
        println!("\n=== Generated llm.md ===\n{}\n", llm);
        
        // Always pass so we can see the output
        assert!(true);
    }
}