---
chunk_index: 318
ref: "4ed1c9ad2d18"
id: "4ed1c9ad2d180b04df15b7cb23c53486754b88c3fbee8f593e92173ee0c95039"
slug: "p6-directions--combined-ranking"
path: "/home/zack/dev/llmx/docs/P6_DIRECTIONS.md"
kind: "markdown"
lines: [473, 498]
token_estimate: 179
content_sha256: "a6c386ef3100b7f101899f0b1c05746b11e8177c5973942a9ebe383c64690231"
compacted: false
heading_path: ["Phase 6: Burn + WebGPU Embeddings & Advanced Hybrid Search","10. llm.cat Integration","Combined Ranking"]
symbol: null
address: null
asset_path: null
---

### Combined Ranking

Merge quality, BM25, and semantic scores:

```typescript
function hybridSearchWithQuality(query: string, chunks: Chunk[], embedder: Embedder) {
  const queryEmb = embedder.embed(query);
  
  return chunks
    .map(chunk => {
      const bm25 = bm25Score(query, chunk.content);
      const semantic = cosineSimilarity(queryEmb, chunk.embedding);
      const quality = chunk.qualityScore;
      
      // RRF-style or weighted combination
      const score = rrf([
        { id: chunk.id, rank: bm25Rank },
        { id: chunk.id, rank: semanticRank }
      ]) * (0.8 + 0.2 * quality);  // Quality boost
      
      return { chunk, score };
    })
    .sort((a, b) => b.score - a.score);
}
```