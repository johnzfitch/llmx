---
chunk_index: 1108
ref: "9d8a3894bc09"
id: "9d8a3894bc09a5ded80006727285b5e063217f922ccb7c31a85b532e14d19e41"
slug: "filetype-tests-l1-120"
path: "/home/zack/dev/llmx/ingestor-core/tests/filetype_tests.rs"
kind: "text"
lines: [1, 120]
token_estimate: 1000
content_sha256: "5860f8ccc2e3c5df62d906216fc74f0b48bc55ddcfdf88b36f10416d6ebb82a9"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

//! File type tests - verify all supported extensions are handled correctly.
//!
//! This test suite ensures that each of the 30+ supported file extensions
//! is properly detected and chunked.
//!
//! Run with: cargo test --test filetype_tests

mod common;

use ingestor_core::{ingest_files, ChunkKind, FileInput, IngestOptions};
use test_case::test_case;

/// Helper to create a FileInput from extension and content.
fn create_file(ext: &str, content: &str) -> FileInput {
    FileInput {
        path: format!("test.{}", ext),
        data: content.as_bytes().to_vec(),
        mtime_ms: None,
        fingerprint_sha256: None,
    }
}

/// Test that a file extension produces expected chunk kind.
fn test_extension_produces_kind(ext: &str, content: &str, expected_kind: ChunkKind) {
    let input = create_file(ext, content);
    let index = ingest_files(vec![input], IngestOptions::default());

    assert!(!index.files.is_empty(), "File should be indexed for .{}", ext);
    assert_eq!(
        index.files[0].kind, expected_kind,
        "Extension .{} should produce {:?}",
        ext, expected_kind
    );
}

// ============================================================================
// Rust
// ============================================================================

#[test]
fn test_filetype_rust() {
    test_extension_produces_kind(
        "rs",
        "fn main() { println!(\"Hello\"); }",
        ChunkKind::Unknown, // Rust files are currently Unknown in detect_kind
    );
}

// ============================================================================
// JavaScript/TypeScript
// ============================================================================

// Note: Currently only js, ts, tsx are mapped to JavaScript in detect_kind.
// jsx, mjs, cjs are allowed extensions but map to Unknown.
#[test_case("js", ChunkKind::JavaScript)]
#[test_case("ts", ChunkKind::JavaScript)]
#[test_case("tsx", ChunkKind::JavaScript)]
fn test_filetype_javascript_core(ext: &str, expected: ChunkKind) {
    test_extension_produces_kind(ext, "function test() { return 42; }", expected);
}

// TODO: These should be JavaScript but currently map to Unknown
#[test_case("jsx", ChunkKind::Unknown)]
#[test_case("mjs", ChunkKind::Unknown)]
#[test_case("cjs", ChunkKind::Unknown)]
fn test_filetype_javascript_unmapped(ext: &str, expected: ChunkKind) {
    test_extension_produces_kind(ext, "function test() { return 42; }", expected);
}

// ============================================================================
// Web
// ============================================================================

#[test]
fn test_filetype_html() {
    test_extension_produces_kind(
        "html",
        "<!DOCTYPE html><html><body>Hello</body></html>",
        ChunkKind::Html,
    );
}

#[test_case("css")]
#[test_case("scss")]
#[test_case("sass")]
#[test_case("less")]
fn test_filetype_stylesheets(ext: &str) {
    let input = create_file(ext, "body { color: red; }");
    let index = ingest_files(vec![input], IngestOptions::default());
    assert!(!index.files.is_empty(), "Style file .{} should be indexed", ext);
}

// ============================================================================
// Data Formats
// ============================================================================

#[test]
fn test_filetype_json() {
    test_extension_produces_kind(
        "json",
        r#"{"key": "value"}"#,
        ChunkKind::Json,
    );
}

#[test_case("yaml")]
#[test_case("yml")]
fn test_filetype_yaml(ext: &str) {
    let input = create_file(ext, "key: value\nlist:\n  - item1\n  - item2");
    let index = ingest_files(vec![input], IngestOptions::default());
    assert!(!index.files.is_empty(), "YAML file .{} should be indexed", ext);
}

#[test]
fn test_filetype_toml() {
    let input = create_file("toml", "[section]\nkey = \"value\"");
    let index = ingest_files(vec![input], IngestOptions::default());
    assert!(!index.files.is_empty(), "TOML file should be indexed");
}