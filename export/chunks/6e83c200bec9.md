---
chunk_index: 1086
ref: "6e83c200bec9"
id: "6e83c200bec975408e0f61f2adf60e1b3e05b04f253fb9c9734bc796ecd279f9"
slug: "lib-l363-421"
path: "/home/zack/dev/llmx/ingestor-core/src/lib.rs"
kind: "text"
lines: [363, 421]
token_estimate: 366
content_sha256: "76ff026a3dd87834ff7f848b4b744592b46472e2ae9b7df1dbf8c7581f39ef32"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

let chunk_refs = build_chunk_refs(&chunks);
    let inverted_index = build_inverted_index(&chunks);
    let stats = compute_stats(&file_metas, &chunks);
    let index_id = compute_index_id(&file_metas);

    IndexFile {
        version: 1,
        index_id,
        files: file_metas,
        chunks,
        chunk_refs,
        inverted_index,
        stats,
        warnings,
        embeddings: None,
        embedding_model: None,
    }
}

pub fn get_chunk(index: &IndexFile, chunk_id: &str) -> Option<Chunk> {
    index.chunks.iter().find(|c| c.id == chunk_id).cloned()
}

pub fn search(index: &IndexFile, query: &str, filters: SearchFilters, limit: usize) -> Vec<SearchResult> {
    search_index(
        &index.chunks,
        &index.inverted_index,
        &index.chunk_refs,
        query,
        &filters,
        limit,
    )
}

fn compute_index_id(files: &[FileMeta]) -> String {
    let mut seed = String::new();
    for file in files {
        seed.push_str(&file.path);
        seed.push('\n');
        seed.push_str(&file.sha256);
        seed.push('\n');
    }
    sha256_hex(seed.as_bytes())
}

fn sanitize_zip_path(input: &str) -> String {
    let replaced = input.replace('\\', "/");
    let mut parts = Vec::new();
    for part in replaced.split('/') {
        if part.is_empty() || part == "." {
            continue;
        }
        if part == ".." {
            continue;
        }
        parts.push(part);
    }
    parts.join("/")
}