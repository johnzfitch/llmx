---
chunk_index: 727
ref: "a83b0f5af919"
id: "a83b0f5af9195b13c43744528e661f0125b17b017a1ac0383345851e7291845b"
slug: "quick-start-phase-5--step-7-update-search-handler-1-hour"
path: "/home/zack/dev/llmx/docs/QUICK_START_PHASE_5.md"
kind: "markdown"
lines: [132, 160]
token_estimate: 198
content_sha256: "ce58ed3198d564472dba3c8985efc077dd0c1aa55f60bc385f5bff14bc3a8071"
compacted: false
heading_path: ["Phase 5 Quick Start Guide","ðŸ“‹ Implementation Steps","Step 7: Update Search Handler (1 hour)"]
symbol: null
address: null
asset_path: null
---

### Step 7: Update Search Handler (1 hour)
```rust
// src/mcp/tools.rs:254

pub fn llmx_search_handler(...) -> Result<SearchOutput> {
    let index = store.load(&input.index_id)?;

    let search_results = if input.use_semantic == Some(true) {
        // NEW: Hybrid search
        let generator = EmbeddingGenerator::new()?;
        let query_embedding = generator.generate(&input.query)?;

        hybrid_search(
            &index.chunks,
            &index.inverted_index,
            index.embeddings.as_ref().unwrap(),
            &input.query,
            &query_embedding,
            limit * 2,
        )
    } else {
        // Existing BM25-only search
        search(&index, &input.query, filters, limit * 2)
    };

    // ... apply token budget (keep existing logic) ...
}
```