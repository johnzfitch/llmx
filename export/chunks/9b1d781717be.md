---
chunk_index: 294
ref: "9b1d781717be"
id: "9b1d781717bef35906234e2d24f4684305f4405d53c925a5df4cde0d01ce87b8"
slug: "p6-directions--implementation"
path: "/home/zack/dev/llmx/docs/P6_DIRECTIONS.md"
kind: "markdown"
lines: [208, 234]
token_estimate: 197
content_sha256: "7a2fe4120ffeb722a5f90526cfa0ebfc6888f6d7690c9f091f8db4d5291a471b"
compacted: false
heading_path: ["Phase 6: Burn + WebGPU Embeddings & Advanced Hybrid Search","3. Reciprocal Rank Fusion (RRF)","Implementation"]
symbol: null
address: null
asset_path: null
---

### Implementation
```rust
pub fn rrf_fusion(
    bm25_results: &[(String, f32)],  // (chunk_id, score)
    semantic_results: &[(String, f32)],
    k: usize,
    limit: usize,
) -> Vec<(String, f32)> {
    let mut scores: HashMap<String, f32> = HashMap::new();

    // BM25 ranks
    for (rank, (chunk_id, _)) in bm25_results.iter().enumerate() {
        *scores.entry(chunk_id.clone()).or_default() += 1.0 / (k + rank + 1) as f32;
    }

    // Semantic ranks
    for (rank, (chunk_id, _)) in semantic_results.iter().enumerate() {
        *scores.entry(chunk_id.clone()).or_default() += 1.0 / (k + rank + 1) as f32;
    }

    let mut merged: Vec<_> = scores.into_iter().collect();
    merged.sort_by(|a, b| b.1.partial_cmp(&a.1).unwrap());
    merged.truncate(limit);
    merged
}
```