---
chunk_index: 1096
ref: "3ca5ac7fb672"
id: "3ca5ac7fb672b2a9994b99aa621751fa1b9453d2659f4ab28c4b9425dff8b17e"
slug: "cli-tests-l166-347"
path: "/home/zack/dev/llmx/ingestor-core/tests/cli_tests.rs"
kind: "text"
lines: [166, 347]
token_estimate: 1058
content_sha256: "7a9d2ea13506bdba2b1f41d6445c5293d70d47e4d8096d469d177e2414dd6157"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

// Search
    llmx()
        .args([
            "search",
            "greet",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success()
        .stdout(predicate::str::contains("Found"))
        .stdout(predicate::str::contains("results"));
}

#[test]
fn test_cli_search_json_output() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "search",
            "fn",
            "--storage-dir",
            storage.path().to_str().unwrap(),
            "--json",
        ])
        .current_dir(project.path())
        .assert()
        .success()
        .stdout(predicate::str::contains("\"results\""))
        .stdout(predicate::str::contains("\"total_matches\""));
}

#[test]
fn test_cli_search_with_limit() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "search",
            "fn",
            "--limit",
            "1",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success();
}

#[test]
fn test_cli_search_with_path_filter() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "search",
            "fn",
            "--path",
            "src/",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success();
}

#[test]
fn test_cli_search_no_index() {
    let storage = TempDir::new().unwrap();
    let empty_dir = TempDir::new().unwrap();

    llmx()
        .args([
            "search",
            "test",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(empty_dir.path())
        .assert()
        .failure()
        .stderr(predicate::str::contains("No index found"));
}

// ============================================================================
// Explore Command Tests
// ============================================================================

#[test]
fn test_cli_explore_files() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "explore",
            "files",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success()
        .stdout(predicate::str::contains("files"))
        .stdout(predicate::str::contains("total"));
}

#[test]
fn test_cli_explore_symbols() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "explore",
            "symbols",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success()
        .stdout(predicate::str::contains("symbols"));
}