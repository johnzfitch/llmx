---
chunk_index: 266
ref: "86cae037bca7"
id: "86cae037bca71033ec5c0f8fac9d9f400496454091c7493cfc2914e57087e622"
slug: "llmx-export-for-opus-review--p1-minexportdata-sharing-export-rs"
path: "/home/zack/dev/llmx/docs/LLMX-EXPORT-FOR-OPUS-REVIEW.md"
kind: "markdown"
lines: [56, 106]
token_estimate: 419
content_sha256: "0d3703ec8b415ddab1231dc7f54b400344e752124bf685b7de847b9535da725e"
compacted: false
heading_path: ["LLMX Export Package for Opus Evaluation","2. Optimization Verification","P1: MinExportData Sharing (export.rs)"]
symbol: null
address: null
asset_path: null
---

### P1: MinExportData Sharing (export.rs)
**Status**: ✅ APPLIED AND ACTIVE

This optimization eliminated 3x redundant data reconstruction in `export_zip_compact`:

Before:
```rust
pub fn export_zip_compact(index: &IndexFile) -> Vec<u8> {
    // ... each function rebuilds data independently
    let catalog = export_catalog_llm_md(index);        // BUILD DATA #1
    let manifest = export_manifest_llm_tsv(index);     // BUILD DATA #2
    let chunks = export_chunks_compact(index);         // BUILD DATA #3
}
```

After:
```rust
pub fn export_zip_compact(index: &IndexFile) -> Vec<u8> {
    // Build shared data ONCE
    let data = MinExportData::build(index);
    
    // All functions use pre-computed data
    let catalog = export_catalog_llm_md_with_data(index, &data);
    let manifest = export_manifest_llm_tsv_with_data(index, &data);
    let chunks = export_chunks_compact_with_data(&data);
}
```

**MinExportData Struct**:
```rust
#[derive(Debug, Clone)]
struct MinExportData {
    paths: Vec<String>,          // Deduped paths
    kinds: Vec<String>,          // Deduped kinds
    entries: Vec<MinExportEntry>, // Pre-built chunk entries
    dirs: Vec<String>,           // Directory index
    path_dirs: Vec<usize>,       // Path → dir mapping
    path_bases: Vec<String>,     // Path basenames
    file_summaries: Vec<FileSummary>, // File metadata
}
```

**Verification in Export**:
- ✅ Single `MinExportData::build()` call in `export_zip_compact`
- ✅ All 28 files processed once with combined sort/dedup
- ✅ File summaries computed once, reused for F-rows and catalog generation

**Expected Speedup**: 3x faster compact exports (verified via elapsed time)

---