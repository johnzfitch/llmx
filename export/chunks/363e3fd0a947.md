---
chunk_index: 180
ref: "363e3fd0a947"
id: "363e3fd0a94712b86107feb5afc23733431de7c9ce86936912596b9f45369f33"
slug: "cutting-edge-enhancements--implementation-plan"
path: "/home/zack/dev/llmx/docs/CUTTING_EDGE_ENHANCEMENTS.md"
kind: "markdown"
lines: [53, 110]
token_estimate: 378
content_sha256: "f980cd91d27e7a2b0123df30575e3c3b0071048c595b7a7f55807592948b3753"
compacted: false
heading_path: ["Cutting-Edge Enhancements for Phases 1-4","1. Learned Sparse Retrieval (SPLADE) ðŸš€","Implementation Plan"]
symbol: null
address: null
asset_path: null
---

### Implementation Plan

**1. Add SPLADE model** (ONNX):
```rust
// src/mcp/splade.rs
pub struct SpladeModel {
    session: ort::Session,
    tokenizer: Tokenizer,
}

impl SpladeModel {
    pub fn expand_query(&self, query: &str) -> HashMap<String, f32> {
        // Input: "authentication"
        // Output: {auth: 2.3, login: 1.8, verify: 1.2, ...}
        let tokens = self.tokenizer.encode(query);
        let input = Array::from_vec(tokens);
        let output = self.session.run([input])?;
        
        // SPLADE output: sparse vector of term weights
        self.decode_sparse_vector(output)
    }
}
```

**2. Enhance search**:
```rust
// tools.rs - search_handler
pub async fn search_handler(input: SearchInput) -> Result<SearchOutput> {
    let index = store.load(&input.index_name)?;
    
    // NEW: Expand query using SPLADE
    let expanded = if input.use_splade {
        splade_model.expand_query(&input.query)?
    } else {
        // Fall back to original query
        tokenize_query(&input.query)
    };
    
    // Use expanded terms in BM25 scoring
    let results = index.search_weighted(expanded, input.limit)?;
    ...
}
```

**Benefits**:
- 15-25% accuracy improvement over BM25
- Still uses inverted index (fast!)
- No vector database needed
- Minimal overhead (ONNX inference ~5ms)

**When to implement**: Phase 5 (alongside embeddings)

**Resources**:
- Paper: "SPLADE: Sparse Lexical and Expansion Model"
- Model: `naver/splade-cocondenser-ensembledistil` (ONNX exportable)

---