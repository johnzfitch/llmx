---
chunk_index: 1302
ref: "7db451f5e235"
id: "7db451f5e235eb77398fb2f59e41b569374ea00ef1defdf788d6ca91aad0bda3"
slug: "test-mcp-server-l150-206"
path: "/home/zack/dev/llmx/test_mcp_server.sh"
kind: "text"
lines: [150, 206]
token_estimate: 499
content_sha256: "b1a3c6256a481dc212233f56a0cb57003412b359e3fdd204c69a76ee9931eb8b"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

# Test 5: Explore (files mode)
echo "Test 5: Explore index (files mode)"
EXPLORE_OUTPUT=$(cat <<EOF | $BINARY 2>/dev/null
{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test","version":"1.0"}}}
{"jsonrpc":"2.0","method":"notifications/initialized"}
{"jsonrpc":"2.0","id":5,"method":"tools/call","params":{"name":"llmx_explore","arguments":{"index_id":"$INDEX_ID","mode":"files"}}}
EOF
)

FILE_LIST=$(echo "$EXPLORE_OUTPUT" | tail -1 | jq -r '.result.content[0].text' | jq -r '.items[]')
echo "$FILE_LIST"

if echo "$FILE_LIST" | grep -q "main.rs" && \
   echo "$FILE_LIST" | grep -q "lib.rs" && \
   echo "$FILE_LIST" | grep -q "README.md"; then
    echo "✓ All files listed"
else
    echo "✗ Missing files in list"
    exit 1
fi
echo ""

# Test 6: Manage (list indexes)
echo "Test 6: List all indexes"
MANAGE_OUTPUT=$(cat <<EOF | $BINARY 2>/dev/null
{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{},"clientInfo":{"name":"test","version":"1.0"}}}
{"jsonrpc":"2.0","method":"notifications/initialized"}
{"jsonrpc":"2.0","id":6,"method":"tools/call","params":{"name":"llmx_manage","arguments":{"action":"list"}}}
EOF
)

INDEX_COUNT=$(echo "$MANAGE_OUTPUT" | tail -1 | jq -r '.result.content[0].text' | jq -r '.indexes | length')
echo "Total indexes: $INDEX_COUNT"

if [ "$INDEX_COUNT" -ge "1" ]; then
    echo "✓ Index listed in registry"
else
    echo "✗ Index not in registry"
    exit 1
fi
echo ""

# Cleanup
rm -rf "$TEST_DIR"
rm -rf "$STORAGE_DIR"

echo "=== All Tests Passed ✓ ==="
echo ""
echo "Phase 4 MCP Server Verification Complete:"
echo "  ✓ Server initialization"
echo "  ✓ 4 tools exposed (index, search, explore, manage)"
echo "  ✓ Index creation with 3 files"
echo "  ✓ Search with inline content (token-budgeted)"
echo "  ✓ Explore mode (files listing)"
echo "  ✓ Manage mode (index registry)"
echo ""
echo "Ready for Phase 5: Semantic Search"