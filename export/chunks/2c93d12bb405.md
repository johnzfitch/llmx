---
chunk_index: 1097
ref: "2c93d12bb405"
id: "2c93d12bb405b8ceabd9cc420d36ea82792b77383d13acdc632d21ac8574f151"
slug: "cli-tests-l348-507"
path: "/home/zack/dev/llmx/ingestor-core/tests/cli_tests.rs"
kind: "text"
lines: [348, 507]
token_estimate: 1007
content_sha256: "9662f1e679169c2fdb35a931738c5615736b3872dd239550668772b997989e78"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

#[test]
fn test_cli_explore_outline() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "explore",
            "outline",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success()
        .stdout(predicate::str::contains("outline"));
}

#[test]
fn test_cli_explore_invalid_mode() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "explore",
            "invalid_mode",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .failure()
        .stderr(predicate::str::contains("Invalid mode"));
}

// ============================================================================
// List Command Tests
// ============================================================================

#[test]
fn test_cli_list_empty() {
    let storage = TempDir::new().unwrap();

    llmx()
        .args(["list", "--storage-dir", storage.path().to_str().unwrap()])
        .assert()
        .success()
        .stdout(predicate::str::contains("No indexes found"));
}

#[test]
fn test_cli_list_with_indexes() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args(["list", "--storage-dir", storage.path().to_str().unwrap()])
        .assert()
        .success()
        .stdout(predicate::str::contains("Indexes:"))
        .stdout(predicate::str::contains("files"))
        .stdout(predicate::str::contains("chunks"));
}

#[test]
fn test_cli_list_json() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    llmx()
        .args([
            "list",
            "--storage-dir",
            storage.path().to_str().unwrap(),
            "--json",
        ])
        .assert()
        .success()
        .stdout(predicate::str::contains("["))
        .stdout(predicate::str::contains("\"id\""));
}

// ============================================================================
// Delete Command Tests
// ============================================================================

#[test]
fn test_cli_delete() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    // Index
    let output = llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
            "--json",
        ])
        .assert()
        .success();

    let stdout = String::from_utf8_lossy(&output.get_output().stdout);
    let json: serde_json::Value = serde_json::from_str(&stdout).unwrap();
    let index_id = json["index_id"].as_str().unwrap();

    // Delete
    llmx()
        .args([
            "delete",
            index_id,
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success()
        .stdout(predicate::str::contains("deleted"));