---
chunk_index: 582
ref: "b268b4024001"
id: "b268b40240016148351c747e2c5dc85b0c6d6182544a299eba0868d95265d109"
slug: "phase-4-directions--4-enhanced-search-response"
path: "/home/zack/dev/llmx/docs/PHASE_4_DIRECTIONS.md"
kind: "markdown"
lines: [71, 93]
token_estimate: 147
content_sha256: "c4f9708eb369891105cdab12dec6f0091b9ec0dabff32c0abc63dc3cc2e3d01e"
compacted: false
heading_path: ["Phase 4: MCP Server Implementation & Tool Consolidation","Primary Objectives","4. Enhanced Search Response"]
symbol: null
address: null
asset_path: null
---

### 4. Enhanced Search Response
**Current Schema**:
```rust
SearchOutput {
    chunk_ids: Vec<String>,
    scores: Vec<f32>,
}
```

**New Schema**:
```rust
SearchOutput {
    results: Vec<SearchResultWithContent>,  // includes full chunk content
    truncated_ids: Option<Vec<String>>,     // only if over token budget
    total_matches: usize,
    query_analysis: Option<String>,         // explain why these results matched
}
```

- [ ] Implement token counting for response size
- [ ] Add configurable budget parameter (default 8K tokens)
- [ ] Include query analysis in verbose mode