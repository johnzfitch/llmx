---
chunk_index: 1200
ref: "96f682f8dfe7"
id: "96f682f8dfe71cb13d1cf67c2d591a9a9e622bac5c2031baa3b31a67c5130688"
slug: "hig-usability-tests-l437-550"
path: "/home/zack/dev/llmx/ingestor-core/tests/hig_usability_tests.rs"
kind: "text"
lines: [437, 550]
token_estimate: 739
content_sha256: "094778a361a8680c11294ee7fabd6f8d9179935c0c5ca78e42436a9eb75a8120"
compacted: false
heading_path: []
symbol: null
address: null
asset_path: null
---

llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    // User can control result count
    llmx()
        .args([
            "search",
            "fn",
            "--limit",
            "1",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success();
}

#[test]
fn test_hig_control_token_budget() {
    // User can control token budget
    llmx()
        .args(["search", "--help"])
        .assert()
        .success()
        .stdout(predicate::str::contains("--max-tokens"));
}

// ============================================================================
// Output Quality
// "Output should be scannable and useful"
// ============================================================================

#[test]
fn test_output_structured_for_scanning() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .assert()
        .success();

    // Search output should be structured
    let output = llmx()
        .args([
            "search",
            "fn",
            "--storage-dir",
            storage.path().to_str().unwrap(),
        ])
        .current_dir(project.path())
        .assert()
        .success();

    let stdout = String::from_utf8_lossy(&output.get_output().stdout);

    // Should have clear section markers
    assert!(
        stdout.contains("Found"),
        "Should indicate result count"
    );
}

#[test]
fn test_json_output_well_formed() {
    let storage = TempDir::new().unwrap();
    let project = create_test_project();

    // Index JSON output
    let output = llmx()
        .args([
            "index",
            project.path().to_str().unwrap(),
            "--storage-dir",
            storage.path().to_str().unwrap(),
            "--json",
        ])
        .assert()
        .success();

    let stdout = String::from_utf8_lossy(&output.get_output().stdout);
    let json: Result<serde_json::Value, _> = serde_json::from_str(&stdout);
    assert!(json.is_ok(), "Index JSON output should be valid JSON");

    // Search JSON output
    let output = llmx()
        .args([
            "search",
            "fn",
            "--storage-dir",
            storage.path().to_str().unwrap(),
            "--json",
        ])
        .current_dir(project.path())
        .assert()
        .success();

    let stdout = String::from_utf8_lossy(&output.get_output().stdout);
    let json: Result<serde_json::Value, _> = serde_json::from_str(&stdout);
    assert!(json.is_ok(), "Search JSON output should be valid JSON");
}